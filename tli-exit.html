<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>D46 TLI Exit Ticket</title>

  <style>
    :root{
      --text:#ffffff;
      --muted:rgba(255,255,255,.78);
      --line:rgba(255,255,255,.28);
      --btn:#1f8fb3;
      --btnHover:#197a99;
      --gold:#f5d44a;
      --ok:rgba(46, 204, 113, .18);
      --okBorder:rgba(46, 204, 113, .35);
      --err:rgba(231, 76, 60, .18);
      --errBorder:rgba(231, 76, 60, .35);
    }

    *{ box-sizing:border-box; }

    /* Use the attached background image */
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:#fff;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:24px;

  /* 1) soft bokeh glow  2) blue overlay  3) background photo */
  background:
    radial-gradient(900px 520px at 25% 15%, rgba(255,255,255,.10), transparent 60%),
    radial-gradient(700px 420px at 70% 30%, rgba(255,255,255,.08), transparent 60%),
    linear-gradient(180deg, rgba(9, 79, 110, .82), rgba(5, 45, 66, .88)),
    url("./TLI_EXIT_TICKET_BACKGROUND.jpg");

  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
}

    .card{
      width:min(620px, 100%);
      border-radius:22px;
      padding:28px 22px 22px;
      background: rgba(0,0,0,.22);
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      backdrop-filter: blur(2px);
      overflow:hidden;
    }

    .hint{
      text-align:center;
      color:var(--gold);
      font-weight:800;
      letter-spacing:.5px;
      font-size:14px;
      margin:4px 0 18px;
      text-transform:uppercase;
    }

    .titleWrap{
      text-align:center;
      background: rgba(255,255,255,.08);
      padding:18px 14px;
      border-radius:18px;
      margin:0 auto 18px;
    }

    .title{
      margin:0;
      font-size:38px;
      line-height:1.08;
      font-weight:900;
    }

    .date{
      margin:6px 0 0;
      font-size:22px;
      color:var(--muted);
      font-weight:800;
    }

    form{ margin-top:16px; }

    .field{ margin:18px 0 22px; }

    label{
      display:block;
      font-size:18px;
      font-weight:800;
      margin-bottom:10px;
    }

    .req{ color:var(--gold); }

    input{
      width:100%;
      background:transparent;
      border:none;
      border-bottom:1px solid var(--line);
      padding:12px 2px 10px;
      color:var(--text);
      font-size:16px;
      outline:none;
    }

    input::placeholder{ color:rgba(255,255,255,.45); }

    .actions{
      display:flex;
      justify-content:flex-end;
      margin-top:18px;
    }

    button{
      border:none;
      background:var(--btn);
      color:white;
      font-weight:900;
      font-size:16px;
      padding:12px 18px;
      border-radius:10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:10px;
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
    }

    button:hover{ background:var(--btnHover); }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .notice{
      display:none;
      margin-top:14px;
      padding:12px 12px;
      border-radius:12px;
      font-weight:800;
    }
    .notice.ok{ background: var(--ok); border:1px solid var(--okBorder); }
    .notice.err{ background: var(--err); border:1px solid var(--errBorder); }

    .small{
      margin-top:10px;
      color:rgba(255,255,255,.75);
      font-size:13px;
      text-align:center;
    }
    .small code{
      background: rgba(255,255,255,.10);
      padding:2px 6px;
      border-radius:8px;
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="hint">Kindly enter your information below and click send for club officer training credit</div>

    <div class="titleWrap">
      <h1 class="title">D46 TLI Exit Ticket</h1>
      <p class="date" id="eventDateText">—</p>
    </div>

    <form id="exitTicketForm" autocomplete="on">
      <div class="field">
        <label>Enter your first and last name <span class="req">*</span></label>
        <input name="fullName" placeholder="Type here..." required />
      </div>

      <div class="field">
        <label>Enter the officer role you trained for today <span class="req">*</span></label>
        <input name="role" placeholder="Type here..." required />
      </div>

      <div class="field">
        <label>Enter your club's full name / not the club # <span class="req">*</span></label>
        <input name="clubName" placeholder="Type here..." required />
      </div>

      <div class="field">
        <label>Enter your District Number <span class="req">*</span></label>
        <input name="districtNumber" placeholder="Type here..." required />
      </div>

      <div class="field">
        <label>Enter your email address <span class="req">*</span></label>
        <input name="email" type="email" placeholder="Type here..." required />
      </div>

      <div class="actions">
        <button id="submitBtn" type="submit">Send <span aria-hidden="true">✈️</span></button>
      </div>

      <div class="notice ok" id="okBox">Submitted! Thank you — your training credit was recorded.</div>
      <div class="notice err" id="errBox"></div>

      <div class="small">
        QR example: <code>?eventDate=2026-01-21</code>
      </div>
    </form>
  </div>

  <script>
    // REQUIRED PARAM: eventDate
    function formatNiceDate(input) {
      const iso = /^(\d{4})-(\d{2})-(\d{2})$/.exec(input);
      if (iso) {
        const y = +iso[1], m = +iso[2], d = +iso[3];
        const dt = new Date(y, m - 1, d);
        return dt.toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' });
      }
      return input; // allow "December 11, 2025" style strings
    }

    const params = new URLSearchParams(location.search);
    const rawEventDate = params.get("eventDate"); // REQUIRED

    const eventDateTextEl = document.getElementById("eventDateText");
    const submitBtn = document.getElementById("submitBtn");
    const errBox = document.getElementById("errBox");
    const okBox = document.getElementById("okBox");
    const form = document.getElementById("exitTicketForm");

    function showErr(msg){
      okBox.style.display = "none";
      errBox.textContent = msg;
      errBox.style.display = "block";
      setTimeout(() => errBox.style.display = "none", 12000);
    }

    function showOk(msg){
      errBox.style.display = "none";
      okBox.textContent = msg;
      okBox.style.display = "block";
      setTimeout(() => okBox.style.display = "none", 6000);
    }

    if (!rawEventDate || rawEventDate.trim() === "") {
      eventDateTextEl.textContent = "Missing event date";
      submitBtn.disabled = true;
      showErr("This link is missing the required event date. Use ?eventDate=2025-12-11");
    }

    const eventDate = rawEventDate ? formatNiceDate(rawEventDate.trim()) : "";
    if (eventDate) eventDateTextEl.textContent = eventDate;

    // Paste your Apps Script Web App URL here:
    const API_URL = "https://script.google.com/macros/s/AKfycby2UJpqwY7X3nUfVCyKkThx_jRz9OZLdZnbDVsj19i45WyIYGd19UaMDTdRbAkOoMP6jg/exec";

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!eventDate) return showErr("Missing event date. Please use the correct QR/link.");

      submitBtn.disabled = true;

      const payload = {
        eventDate,
        fullName: form.fullName.value.trim(),
        role: form.role.value.trim(),
        clubName: form.clubName.value.trim(),
        districtNumber: form.districtNumber.value.trim(),
        email: form.email.value.trim(),
        source: "tli-exit-web"
      };

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok || !data.ok) {
          return showErr((data && (data.error || data.message)) ? (data.error || data.message) : "Submission failed.");
        }

        form.reset();
        showOk("Submitted! Thank you — your training credit was recorded.");
      } catch (err) {
        showErr("Network error. Please check your connection and try again.");
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
