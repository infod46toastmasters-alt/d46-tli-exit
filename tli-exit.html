<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>D46 TLI Exit Ticket</title>

  <!-- Load the font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  <style>
    :root{
      --text:#ffffff;
      --muted:rgba(255,255,255,.78);
      --line:rgba(255,255,255,.28);
      --btn:#1f8fb3;
      --btnHover:#197a99;
      --gold:#f5d44a;
      --ok:rgba(46, 204, 113, .18);
      --okBorder:rgba(46, 204, 113, .35);
      --err:rgba(231, 76, 60, .18);
      --errBorder:rgba(231, 76, 60, .35);

      --fuenteGlobal: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      --tamano-texto: 2; /* 8px * 2 = 16px base */
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: var(--fuenteGlobal);
      font-size: calc(8px * var(--tamano-texto));
      color:#fff;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:24px;

      /* 1) soft bokeh glow  2) blue overlay  3) background photo */
      background:
        radial-gradient(900px 520px at 25% 15%, rgba(255,255,255,.10), transparent 60%),
        radial-gradient(700px 420px at 70% 30%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, rgba(9, 79, 110, .82), rgba(5, 45, 66, .88)),
        url("./TLI_EXIT_TICKET_BACKGROUND.jpg");

      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    .card{
      width:min(620px, 100%);
      border-radius:22px;
      padding:28px 22px 22px;
      background: rgba(0,0,0,.22);
      box-shadow: 0 14px 40px rgba(0,0,0,.45);
      backdrop-filter: blur(2px);
      overflow:hidden;
    }

    .hint{
      text-align:center;
      color:var(--gold);
      font-weight:800;
      letter-spacing:.5px;
      font-size:14px;
      margin:4px 0 18px;
      text-transform:uppercase;
      line-height:1.2;
      font-style: italic;
    }

    .titleWrap{
      text-align:center;
      background: rgba(255,255,255,.08);
      padding:18px 14px;
      border-radius:18px;
      margin:0 auto 18px;
    }

    .title{
      margin:0;
      font-size:38px;
      line-height:1.2;
      font-weight:900;
      color:#fff;
    }

    .date{
      margin:6px 0 0;
      font-size:22px;
      color:var(--muted);
      font-weight:800;
    }

    form{ margin-top:16px; }

    .field{ margin:18px 0 22px; }

    label{
      display:block;
      font-size:17px;
      font-weight:800;
      margin-bottom:10px;
    }

    .req{ color:var(--gold); }

    input{
      width:100%;
      background:transparent;
      border:none;
      border-bottom:1px solid var(--line);
      padding:12px 2px 10px;
      color:var(--text);
      font-size:16px;
      outline:none;
    }

    input::placeholder{ color:rgba(255,255,255,.45); }

    select{
	  width:100%;
	  background:transparent;
	  border:none;
	  border-bottom:1px solid var(--line);
	  padding:12px 2px 10px;
	  color:var(--text);
	  font-size:16px;
	  outline:none;
	  appearance:none;
	}

	select option{
	  color:#000; /* options list needs dark text to be readable */
}

    .actions{
      display:flex;
      justify-content:flex-end;
      margin-top:18px;
    }

    button{
      border:none;
      background:var(--btn);
      color:white;
      font-weight:900;
      font-size:16px;
      padding:12px 18px;
      border-radius:10px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:10px;
      box-shadow: 0 10px 20px rgba(0,0,0,.25);
    }

    button:hover{ background:var(--btnHover); }

    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .notice{
      display:none;
      margin-top:14px;
      padding:12px 12px;
      border-radius:12px;
      font-weight:800;
    }
    .notice.ok{ background: var(--ok); border:1px solid var(--okBorder); }
    .notice.err{ background: var(--err); border:1px solid var(--errBorder); }

    /* Thank-you screen */
    #thankYouScreen{
      display:none;
      text-align:center;
      padding:10px 8px 6px;
    }
    #thankYouScreen .ty-title{
      font-size:28px;
      font-weight:900;
      line-height:1.25;
      color:#fff;
    }
    #thankYouScreen .ty-body{
      margin-top:16px;
      font-size:20px;
      font-weight:800;
      line-height:1.35;
      color:rgba(255,255,255,.92);
    }
    #thankYouScreen .ty-footer{
      margin-top:18px;
      font-size:20px;
      font-weight:900;
      line-height:1.35;
      color:#fff;
    }
    #thankYouScreen .ty-email{
      color:var(--gold);
      word-break: break-word;
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="hint">Kindly enter your information below and click send for club officer training credit</div>

    <div class="titleWrap">
      <h1 class="title">D46 TLI Exit Ticket</h1>
      <p class="date" id="eventDateText">—</p>
    </div>

    <!-- Hidden iframe target to avoid CORS (no fetch) -->
    <iframe name="hidden_iframe" style="display:none;"></iframe>

    <!-- THANK YOU SCREEN -->
    <div id="thankYouScreen">
      <div class="ty-title">
        Thank You! Your attendance for<br/>
        Winter TLI is confirmed.
      </div>

      <div class="ty-body">
        Certificate of attendance will be<br/>
        emailed to you between 48–72<br/>
        hours. Thank you for attending<br/>
        District 46 TLI! If you are not from<br/>
        District 46, the certificate received in 48–72 hours, MUST be emailed to your District's PQD.
      </div>

      <div class="ty-footer">
        Please CC D46 PQD Stella Umunna at<br/>
        <span class="ty-email">sumunna@gmail.com</span>
      </div>
    </div>

    <!-- FORM SCREEN (hidden after submit) -->
    <div id="formScreen">
      <form id="exitTicketForm"
            method="POST"
            target="hidden_iframe"
            action="https://script.google.com/macros/s/AKfycby2UJpqwY7X3nUfVCyKkThx_jRz9OZLdZnbDVsj19i45WyIYGd19UaMDTdRbAkOoMP6jg/exec"
            autocomplete="on">

        <!-- Hidden fields sent to Apps Script -->
        <input type="hidden" name="eventDate" id="eventDateHidden">
        <input type="hidden" name="source" value="tli-exit-web">

        <div class="field">
          <label>Enter your first and last name <span class="req">*</span></label>
          <input name="fullName" placeholder="Type here..." required />
        </div>

        <div class="field">
		  <label>Enter the officer role you trained for today <span class="req">*</span></label>
		  <select name="role" required>
		    <option value="" disabled selected>Select a role...</option>
		    <option>President</option>
		    <option>Vice President Education (VPE)</option>
		    <option>Vice President Membership (VPM)</option>
		    <option>Vice President Public Relations (VPPR)</option>
		    <option>Secretary</option>
		    <option>Treasurer</option>
		    <option>Sergeant at Arms (SAA)</option>
		  </select>
		</div>


        <div class="field">
          <label>Enter your club's full name / not the club # <span class="req">*</span></label>
          <input name="clubName" placeholder="Type here..." required />
        </div>

        <div class="field">
          <label>Enter your District Number <span class="req">*</span></label>
          <input name="districtNumber" placeholder="Type here..." required />
        </div>

        <div class="field">
          <label>Enter your email address <span class="req">*</span></label>
          <input name="email" type="email" placeholder="Type here..." required />
        </div>

        <div class="actions">
          <button id="submitBtn" type="submit">
            Send <span aria-hidden="true"><i class="far fa-paper-plane ml-2"></i></span>
          </button>
        </div>

        <div class="notice err" id="errBox"></div>
      </form>
    </div>
  </div>

  <script>
    function formatNiceDate(input) {
      const iso = /^(\d{4})-(\d{2})-(\d{2})$/.exec(input);
      if (iso) {
        const y = +iso[1], m = +iso[2], d = +iso[3];
        const dt = new Date(y, m - 1, d);
        return dt.toLocaleDateString(undefined, { year:'numeric', month:'long', day:'numeric' });
      }
      return input;
    }

    const params = new URLSearchParams(location.search);
    const rawEventDate = params.get("eventDate");

    const eventDateTextEl = document.getElementById("eventDateText");
    const eventDateHidden = document.getElementById("eventDateHidden");
    const submitBtn = document.getElementById("submitBtn");
    const errBox = document.getElementById("errBox");
    const form = document.getElementById("exitTicketForm");

    const thankYouScreen = document.getElementById("thankYouScreen");
    const formScreen = document.getElementById("formScreen");

    function showErr(msg){
      errBox.textContent = msg;
      errBox.style.display = "block";
      setTimeout(() => errBox.style.display = "none", 12000);
    }

    if (!rawEventDate || rawEventDate.trim() === "") {
      eventDateTextEl.textContent = "Missing event date";
      submitBtn.disabled = true;
      showErr("This link is missing the required event date. Use ?eventDate=2025-12-11");
    } else {
      const eventDate = formatNiceDate(rawEventDate.trim());
      eventDateTextEl.textContent = eventDate;
      eventDateHidden.value = eventDate;
    }

    // No fetch(). Browser submits form to hidden iframe (avoids CORS).
    // On submit, replace the form with the Thank You message.
    form.addEventListener("submit", (e) => {
      if (!eventDateHidden.value) {
        e.preventDefault();
        showErr("Missing event date. Please use the correct QR/link.");
        return;
      }

      // Let the POST happen, but swap UI immediately
      formScreen.style.display = "none";
      thankYouScreen.style.display = "block";

      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  </script>
</body>
</html>
